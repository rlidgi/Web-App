<!-- filepath: templates/my_revisions.html -->
<!DOCTYPE html>
<html lang="en">
<script defer src="/static/js/script.js"></script>

<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KRPLMCR73G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-KRPLMCR73G');
    </script>

    <script defer>
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i + "?ref=bwt";
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "sjihir10df");
    </script>


    <!-- TrustBox script -->
    <script type="text/javascript" src="//widget.trustpilot.com/bootstrap/v5/tp.widget.bootstrap.min.js" async></script>
    <!-- End TrustBox script -->


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Your centralized Job Search Hub: generate tailored resumes for specific job descriptions, store every version, and track which resume you applied with.">
    <title>{% if user and user.name and user.name.strip() %}{{ user.name.split()[0] }}'s{% else %}My{% endif %} Job
        Search Hub - Resumatic AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        'primary-dark': '#2563EB'
                    }
                }
            }
        }        // Toggle notes display/edit mode
        function toggleNotes(revisionId) {
            const displayDiv = document.getElementById(`notes-display-${revisionId}`);
            const editDiv = document.getElementById(`notes-edit-${revisionId}`);
            const emptyDiv = document.getElementById(`notes-empty-${revisionId}`);

            if (displayDiv.classList.contains('hidden')) {
                // Currently in edit mode, show display mode
                displayDiv.classList.remove('hidden');
                editDiv.classList.add('hidden');
                if (emptyDiv) emptyDiv.classList.add('hidden');
            } else {
                // Currently in display mode, show edit mode
                displayDiv.classList.add('hidden');
                editDiv.classList.remove('hidden');
                if (emptyDiv) emptyDiv.classList.add('hidden');
            }
        }        // Convert UTC timestamps to local timezone
        // Toggle job description panel
        function toggleJobDesc(revisionId) {
            const div = document.getElementById(`jobdesc-${revisionId}`);
            if (!div) return;
            div.classList.toggle('hidden');
        }

        // Toggle application add form
        function toggleAppForm(revisionId) {
            const div = document.getElementById(`appform-${revisionId}`);
            if (!div) return;
            div.classList.toggle('hidden');
        }

        function convertToLocalTime() {
            // Convert date-only elements (for stats)
            document.querySelectorAll('.local-date').forEach(element => {
                const utcDate = element.getAttribute('data-utc-date');
                if (utcDate && utcDate.trim()) {
                    try {
                        const date = new Date(utcDate);
                        if (!isNaN(date.getTime())) {
                            const localDate = date.toLocaleDateString('en-US', {
                                month: 'numeric',
                                day: 'numeric'
                            });
                            element.textContent = localDate;
                        }
                    } catch (e) {
                        console.log('Error parsing date:', utcDate);
                    }
                }
            });

            // Convert full datetime elements (for revision entries)
            document.querySelectorAll('.local-datetime').forEach(element => {
                const utcDate = element.getAttribute('data-utc-date');
                if (utcDate && utcDate.trim()) {
                    try {
                        const date = new Date(utcDate);
                        if (!isNaN(date.getTime())) {
                            const localDateTime = date.toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            }) + ' at ' + date.toLocaleTimeString('en-US', {
                                hour: 'numeric',
                                minute: '2-digit',
                                hour12: true
                            });
                            element.textContent = localDateTime;
                        }
                    } catch (e) {
                        console.log('Error parsing datetime:', utcDate);
                    }
                }
            });
        }

        // Convert timestamps when page loads
        document.addEventListener('DOMContentLoaded', convertToLocalTime);
    </script>
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
        }

        /* Mobile menu styles */
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }

        .mobile-menu.active {
            transform: translateX(0);
        }

        .nav-link {
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #3B82F6;
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans"
    style="background-image: url('/static/images/bg13.png'); background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">

    <!-- Download Feedback Modal -->
    <div id="downloadFeedbackModal" class="fixed inset-0 bg-black/60 z-[9999] hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="flex items-center justify-between px-5 py-4 border-b">
                <h3 class="font-semibold text-lg text-gray-800">How was your resume?</h3>
                <button id="downloadFeedbackClose" class="text-gray-500 hover:text-gray-800"
                    aria-label="Close">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <p class="text-sm text-gray-600">Your feedback helps us improve ResumaticAI.</p>
                <div class="space-y-2">
                    <div class="text-sm font-medium text-gray-800">Overall, how satisfied are you?</div>
                    <div id="downloadStars" class="flex items-center gap-1" role="radiogroup" aria-label="Rating">
                        <input type="radio" name="download_rating" id="download_rating_1" value="1" class="hidden">
                        <label for="download_rating_1" data-value="1" class="cursor-pointer text-gray-300 text-2xl p-1">
                            <i class="fas fa-star"></i>
                        </label>
                        <input type="radio" name="download_rating" id="download_rating_2" value="2" class="hidden">
                        <label for="download_rating_2" data-value="2" class="cursor-pointer text-gray-300 text-2xl p-1">
                            <i class="fas fa-star"></i>
                        </label>
                        <input type="radio" name="download_rating" id="download_rating_3" value="3" class="hidden">
                        <label for="download_rating_3" data-value="3" class="cursor-pointer text-gray-300 text-2xl p-1">
                            <i class="fas fa-star"></i>
                        </label>
                        <input type="radio" name="download_rating" id="download_rating_4" value="4" class="hidden">
                        <label for="download_rating_4" data-value="4" class="cursor-pointer text-gray-300 text-2xl p-1">
                            <i class="fas fa-star"></i>
                        </label>
                        <input type="radio" name="download_rating" id="download_rating_5" value="5" class="hidden">
                        <label for="download_rating_5" data-value="5" class="cursor-pointer text-gray-300 text-2xl p-1">
                            <i class="fas fa-star"></i>
                        </label>
                    </div>
                    <div id="downloadStarText" class="text-xs text-gray-500 mt-1 h-4"></div>
                    <div class="mt-3 space-y-2">
                        <div class="text-sm font-medium text-gray-800">Compared to your original resume, this is:</div>
                        <div id="downloadComparisonGroup" class="flex flex-col gap-2 sm:flex-row sm:items-center">
                            <label
                                class="inline-flex items-center gap-2 cursor-pointer border rounded-full px-3 py-1 text-sm text-gray-700 border-gray-300 transition-colors">
                                <input type="radio" name="download_comparison" value="improved" class="accent-blue-600">
                                <span class="text-sm">Improved</span>
                            </label>
                            <label
                                class="inline-flex items-center gap-2 cursor-pointer border rounded-full px-3 py-1 text-sm text-gray-700 border-gray-300 transition-colors">
                                <input type="radio" name="download_comparison" value="same" class="accent-blue-600">
                                <span class="text-sm">About the same</span>
                            </label>
                            <label
                                class="inline-flex items-center gap-2 cursor-pointer border rounded-full px-3 py-1 text-sm text-gray-700 border-gray-300 transition-colors">
                                <input type="radio" name="download_comparison" value="worse" class="accent-blue-600">
                                <span class="text-sm">Worse</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="downloadFeedbackComment" class="block text-sm font-medium text-gray-800 mb-1">Anything
                        we could improve?</label>
                    <textarea id="downloadFeedbackComment"
                        class="w-full border rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows="3" placeholder="Optional"></textarea>
                </div>
            </div>
            <div class="px-5 py-4 border-t flex items-center justify-end gap-2">
                <button id="downloadFeedbackSkip" class="px-4 py-2 text-gray-700 hover:text-gray-900">Maybe
                    later</button>
                <button id="downloadFeedbackSubmit"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Send feedback</button>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu fixed top-0 right-0 h-full w-64 bg-white shadow-lg z-50 p-6 hidden" id="mobileMenu">
        <div class="flex justify-between items-center mb-8">

            <button class="text-gray-500 hover:text-gray-900" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="space-y-4">
            <a class="block text-gray-600 hover:text-primary" href="/">Home</a>
            <a class="block text-gray-600 hover:text-primary" href="/blog">Blog</a>
            <a class="block text-gray-600 hover:text-primary" href="/about">About</a>
            <a class="block text-gray-600 hover:text-primary" href="/plans">Pricing</a>
            <a class="block text-gray-600 hover:text-primary" href="/contact">Contact</a>
            {% if user and user.is_authenticated %}
            <a class="block px-4 py-2 bg-primary text-white rounded hover:bg-primary/90 text-center" href="/logout">
                Logout
            </a>
            {% else %}
            <a class="block px-4 py-2 bg-primary text-white rounded hover:bg-primary/90 text-center" href="/login">
                Login
            </a>
            {% endif %}
        </nav>
    </div>

    <!-- Main Navigation -->
    <header role="banner">
        <nav aria-label="Main navigation" class="bg-white shadow-sm sticky top-0 z-50" role="navigation">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-20 items-center">
                    <div class="flex items-center">
                        <a class="flex items-center" href="/">

                            <span class="sr-only">Resumatic AI</span>
                        </a>
                    </div>
                    <div class="hidden md:flex items-center space-x-8">
                        <a class="nav-link text-gray-600 hover:text-primary transition-colors" href="/">Home</a>
                        <a class="nav-link text-gray-600 hover:text-primary transition-colors" href="/blog">Blog</a>
                        <a class="nav-link text-gray-600 hover:text-primary transition-colors" href="/about">About</a>
                        <a class="nav-link text-gray-600 hover:text-primary transition-colors" href="/plans">Pricing</a>
                        <a class="nav-link text-gray-600 hover:text-primary transition-colors"
                            href="/contact">Contact</a>
                        {% if user and user.is_authenticated %}
                        <a href="/settings" aria-label="Settings" title="Settings"
                            class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-200 bg-white text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors">
                            <i aria-hidden="true" class="fas fa-gear"></i>
                        </a>
                        <a href="/logout" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90">
                            Logout
                        </a>
                        {% else %}
                        <a href="/login" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90">
                            Login
                        </a>
                        {% endif %}
                    </div>
                    <button aria-expanded="false" aria-label="Toggle menu"
                        class="md:hidden text-gray-600 hover:text-gray-900" id="menuButton">
                        <i aria-hidden="true" class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Header Section -->
    <div class="bg-white/90 backdrop-blur-sm shadow-sm sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between gap-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200">
                        <img src="{{ url_for('static', filename='images/logo23_small.png') }}" alt="Resumatic AI"
                            class="w-[2.4rem] h-[2.4rem] object-contain" loading="lazy" />
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight text-gray-900">
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-emerald-600">
                                {% if user and user.name and user.name.strip() %}{{ user.name.split()[0] }}'s{% else
                                %}My{%
                                endif %}
                            </span>
                            <span class="text-gray-900">Job Search Hub</span>
                        </h1>
                        <p class="text-sm text-gray-600"></p>
                    </div>
                </div>

                <!-- Settings link moved to top navigation next to Logout -->
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="max-w-5xl mx-auto px-6 mt-4">
        {% for category, message in messages %}
        <div
            class="mb-4 p-4 rounded-lg {% if category == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-red-100 border border-red-400 text-red-700{% endif %}">
            <div class="flex items-center">
                <i
                    class="fas {% if category == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %} mr-2"></i>
                {{ message }}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="max-w-5xl mx-auto p-6">

        <!-- Mission + CTAs -->
        <div
            class="mb-6 bg-gradient-to-r from-indigo-50/70 via-white/90 to-emerald-50/70 backdrop-blur-sm border border-gray-200 rounded-2xl p-5 shadow-sm">
            <div class="grid grid-cols-1 lg:grid-cols-[1fr_520px] gap-3 items-center">
                <div>
                    <div
                        class="inline-flex items-center gap-2 px-2 py-0.5 rounded-full bg-indigo-100/70 border border-indigo-200 text-indigo-800 text-xs font-semibold">
                        <i class="fas fa-bullseye"></i>
                        Tailor to the job description
                    </div>

                    <h2 class="text-xl sm:text-2xl font-extrabold text-gray-900 mt-2 leading-tight tracking-tight">
                        Tailored resumes win interviews
                    </h2>
                    <p class="text-sm text-gray-700 mt-2 leading-relaxed max-w-xl">
                        Generate a role-specific resume in seconds, then track which version you used for each
                        application.
                    </p>
                    <a href="/blog/tailorresumejob"
                        class="inline-flex items-center gap-2 mt-2 text-indigo-700 hover:text-indigo-900 font-semibold hover:underline underline-offset-4">
                        Learn why tailoring works
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>

                    <div class="mt-3 flex flex-col sm:flex-row gap-2">
                        <a href="/?scroll_to_form=true"
                            class="inline-flex items-center justify-center px-3 py-1.5 btn-primary text-white rounded-lg hover:shadow-lg transition-all duration-200 font-medium">
                            <i class="fas fa-bolt mr-2"></i>
                            Create tailored resume
                        </a>
                    </div>
                </div>

                <!-- Cute JD -> Tailored Resume animation -->
                <div class="hidden lg:block">
                    <div class="w-full max-w-[520px] ml-auto">
                        <svg viewBox="0 0 720 260" xmlns="http://www.w3.org/2000/svg" role="img"
                            aria-labelledby="title desc">
                            <title id="title">Cutesy job description to tailored resume animation</title>
                            <desc id="desc">
                                A smiling job description page sends little keyword bubbles through a cute
                                tailoring machine, producing a happy tailored resume with sparkles and checkmarks.
                            </desc>

                            <style>
                                :root {
                                    --accent: #6366f1;
                                    /* cute indigo */
                                    --accent2: #22c55e;
                                    /* friendly green */
                                    --pink: #fb7185;
                                    /* blush */
                                    --ink: #111827;
                                    --muted: #64748b;
                                    --bg: #fff7ed;
                                    /* warm cream */
                                    --card: #ffffff;
                                    --stroke: #e2e8f0;
                                    --soft: #f1f5f9;
                                }

                                .font {
                                    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                                }

                                .panel {
                                    fill: var(--bg);
                                    stroke: var(--stroke);
                                    stroke-width: 2;
                                    rx: 16;
                                    ry: 16;
                                }

                                .card {
                                    fill: var(--card);
                                    stroke: var(--stroke);
                                    stroke-width: 2;
                                    rx: 16;
                                    ry: 16;
                                }

                                .title {
                                    font-size: 13px;
                                    font-weight: 800;
                                    fill: var(--ink);
                                }

                                .label {
                                    font-size: 10px;
                                    font-weight: 650;
                                    fill: var(--muted);
                                }

                                .tiny {
                                    font-size: 9px;
                                    fill: #6b7280;
                                }

                                .line {
                                    stroke: #cbd5e1;
                                    stroke-width: 3;
                                    stroke-linecap: round;
                                }

                                .line.accent {
                                    stroke: var(--accent);
                                }

                                /* Cute faces */
                                .face-eye {
                                    fill: var(--ink);
                                }

                                .face-smile {
                                    fill: none;
                                    stroke: var(--ink);
                                    stroke-width: 2.2;
                                    stroke-linecap: round;
                                }

                                .blush {
                                    fill: var(--pink);
                                    opacity: .35;
                                }

                                /* Waving animation (JD page wiggle) */
                                .wiggle {
                                    transform-origin: 140px 120px;
                                    animation: wiggle 3.2s ease-in-out infinite;
                                }

                                @keyframes wiggle {

                                    0%,
                                    100% {
                                        transform: rotate(0deg);
                                    }

                                    15% {
                                        transform: rotate(-1.2deg);
                                    }

                                    30% {
                                        transform: rotate(1.2deg);
                                    }

                                    45% {
                                        transform: rotate(-0.6deg);
                                    }

                                    60% {
                                        transform: rotate(0.6deg);
                                    }
                                }

                                /* Cute conveyor flow */
                                .flow {
                                    fill: none;
                                    stroke: #94a3b8;
                                    stroke-width: 2;
                                    stroke-linecap: round;
                                    stroke-dasharray: 5 7;
                                    animation: dash 2.1s linear infinite;
                                }

                                @keyframes dash {
                                    to {
                                        stroke-dashoffset: -26;
                                    }
                                }

                                /* Keyword bubbles (float across) */
                                .bubble {
                                    fill: #eef2ff;
                                    stroke: #c7d2fe;
                                    stroke-width: 1.5;
                                }

                                .bubble-text {
                                    font-size: 9px;
                                    font-weight: 750;
                                    fill: #4338ca;
                                }

                                .bubble-group {
                                    opacity: 0;
                                    animation: floaty 3.2s ease-in-out infinite;
                                }

                                .bubble-group.b2 {
                                    animation-delay: .55s;
                                }

                                .bubble-group.b3 {
                                    animation-delay: 1.1s;
                                }

                                /* Path: JD -> machine -> resume */
                                @keyframes floaty {
                                    0% {
                                        opacity: 0;
                                        transform: translate(0px, 0px) scale(.9);
                                    }

                                    10% {
                                        opacity: 1;
                                    }

                                    45% {
                                        opacity: 1;
                                        transform: translate(220px, 0px) scale(1.0);
                                    }

                                    58% {
                                        opacity: 1;
                                        transform: translate(260px, 0px) scale(.92);
                                    }

                                    78% {
                                        opacity: 1;
                                        transform: translate(410px, 0px) scale(1.0);
                                    }

                                    100% {
                                        opacity: 0;
                                        transform: translate(410px, 0px) scale(1.0);
                                    }
                                }

                                /* Tailor machine */
                                .machine {
                                    fill: #f8fafc;
                                    stroke: #cbd5e1;
                                    stroke-width: 2;
                                    rx: 18;
                                    ry: 18;
                                }

                                .machine-top {
                                    fill: #eef2ff;
                                }

                                .gear {
                                    fill: none;
                                    stroke: var(--accent);
                                    stroke-width: 2;
                                    transform-origin: 0px 0px;
                                    animation: spin 2.8s linear infinite;
                                }

                                @keyframes spin {
                                    to {
                                        transform: rotate(360deg);
                                    }
                                }

                                .bar-track {
                                    fill: #e2e8f0;
                                    rx: 10;
                                    ry: 10;
                                }

                                .bar-fill {
                                    fill: var(--accent);
                                    rx: 10;
                                    ry: 10;
                                    transform-origin: 0px 0px;
                                    animation: fill 3.2s ease-in-out infinite;
                                }

                                @keyframes fill {
                                    0% {
                                        transform: scaleX(.08);
                                        opacity: .5;
                                    }

                                    25% {
                                        transform: scaleX(.35);
                                        opacity: 1;
                                    }

                                    60% {
                                        transform: scaleX(.75);
                                        opacity: 1;
                                    }

                                    82% {
                                        transform: scaleX(1.0);
                                        opacity: 1;
                                    }

                                    100% {
                                        transform: scaleX(1.0);
                                        opacity: .65;
                                    }
                                }

                                /* Resume glow + happy */
                                .glow {
                                    stroke: var(--accent);
                                    stroke-width: 2.5;
                                    stroke-opacity: .15;
                                    animation: glow 3.2s ease-in-out infinite;
                                }

                                @keyframes glow {

                                    0%,
                                    55% {
                                        stroke-opacity: .10;
                                    }

                                    72% {
                                        stroke-opacity: .65;
                                    }

                                    100% {
                                        stroke-opacity: .18;
                                    }
                                }

                                .out-highlight {
                                    stroke: var(--accent);
                                    stroke-width: 3;
                                    stroke-linecap: round;
                                    stroke-opacity: .18;
                                    animation: outPulse 3.2s ease-in-out infinite;
                                }

                                .out-highlight.h2 {
                                    animation-delay: .55s;
                                }

                                .out-highlight.h3 {
                                    animation-delay: 1.1s;
                                }

                                @keyframes outPulse {

                                    0%,
                                    60% {
                                        stroke-opacity: .15;
                                    }

                                    74% {
                                        stroke-opacity: 1;
                                    }

                                    100% {
                                        stroke-opacity: .2;
                                    }
                                }

                                .check {
                                    fill: none;
                                    stroke: var(--accent2);
                                    stroke-width: 2.2;
                                    stroke-linecap: round;
                                    stroke-linejoin: round;
                                    stroke-dasharray: 16;
                                    stroke-dashoffset: 16;
                                    animation: draw 3.2s ease-in-out infinite;
                                }

                                .check.c2 {
                                    animation-delay: .55s;
                                }

                                .check.c3 {
                                    animation-delay: 1.1s;
                                }

                                @keyframes draw {

                                    0%,
                                    66% {
                                        stroke-dashoffset: 16;
                                        opacity: 0;
                                    }

                                    72% {
                                        opacity: 1;
                                    }

                                    82% {
                                        stroke-dashoffset: 0;
                                        opacity: 1;
                                    }

                                    100% {
                                        stroke-dashoffset: 0;
                                        opacity: .95;
                                    }
                                }

                                /* Sparkles */
                                .sparkle {
                                    fill: var(--accent);
                                    opacity: 0;
                                    animation: sparkle 3.2s ease-in-out infinite;
                                }

                                .sparkle.s2 {
                                    animation-delay: .2s;
                                }

                                .sparkle.s3 {
                                    animation-delay: .4s;
                                }

                                @keyframes sparkle {

                                    0%,
                                    63% {
                                        opacity: 0;
                                        transform: scale(.7);
                                    }

                                    74% {
                                        opacity: 1;
                                        transform: scale(1.05);
                                    }

                                    92% {
                                        opacity: 0;
                                        transform: scale(.8);
                                    }

                                    100% {
                                        opacity: 0;
                                    }
                                }
                            </style>

                            <!-- LEFT: Cute Job Description -->
                            <g class="wiggle" transform="translate(28, 40)">
                                <rect class="panel" width="250" height="170" />
                                <text class="font title" x="18" y="28">Job Description</text>
                                <text class="font label" x="18" y="46">Input friend ✨</text>

                                <!-- "page" icon inside -->
                                <rect x="18" y="58" width="214" height="96" rx="14" ry="14" fill="#ffffff"
                                    stroke="#e5e7eb" stroke-width="2" />

                                <!-- Face -->
                                <circle class="blush" cx="70" cy="96" r="7" />
                                <circle class="blush" cx="112" cy="96" r="7" />
                                <circle class="face-eye" cx="78" cy="90" r="2.2" />
                                <circle class="face-eye" cx="104" cy="90" r="2.2" />
                                <path class="face-smile" d="M 84 98 Q 91 105 98 98" />

                                <!-- Lines -->
                                <line class="line accent" x1="62" y1="118" x2="210" y2="118" />
                                <line class="line" x1="62" y1="132" x2="185" y2="132" />
                                <line class="line accent" x1="62" y1="146" x2="200" y2="146" />
                            </g>

                            <!-- Cute flow paths -->
                            <path class="flow" d="M 278 128 C 320 98, 350 98, 380 118" />
                            <path class="flow" d="M 278 138 C 320 164, 350 164, 380 142" />

                            <!-- CENTER: Tailor Machine (cute) -->
                            <g transform="translate(370, 70)">
                                <rect class="machine" width="160" height="130" />
                                <rect class="machine-top" x="0" y="0" width="160" height="36" rx="18" ry="18" />
                                <text class="font title" x="14" y="23" style="font-size:12px;">Tailor Bot</text>
                                <text class="font tiny" x="14" y="34">*beep boop*</text>

                                <!-- tiny gear -->
                                <g transform="translate(132, 20)">
                                    <circle class="gear" cx="0" cy="0" r="10" />
                                    <line class="gear" x1="0" y1="-14" x2="0" y2="-10" />
                                    <line class="gear" x1="0" y1="14" x2="0" y2="10" />
                                    <line class="gear" x1="-14" y1="0" x2="-10" y2="0" />
                                    <line class="gear" x1="14" y1="0" x2="10" y2="0" />
                                    <line class="gear" x1="10" y1="10" x2="7" y2="7" />
                                    <line class="gear" x1="-10" y1="10" x2="-7" y2="7" />
                                    <line class="gear" x1="10" y1="-10" x2="7" y2="-7" />
                                    <line class="gear" x1="-10" y1="-10" x2="-7" y2="-7" />
                                </g>

                                <!-- progress -->
                                <rect class="bar-track" x="14" y="52" width="132" height="16" />
                                <rect class="bar-fill" x="14" y="52" width="132" height="16" />

                                <!-- little "mouth" -->
                                <circle class="face-eye" cx="38" cy="92" r="2.1" />
                                <circle class="face-eye" cx="52" cy="92" r="2.1" />
                                <path class="face-smile" d="M 40 100 Q 45 104 50 100" />
                                <circle class="blush" cx="31" cy="98" r="5" />
                                <circle class="blush" cx="59" cy="98" r="5" />

                                <text class="font label" x="72" y="96">Tailoring…</text>
                                <text class="font tiny" x="72" y="112">matching keywords</text>
                            </g>

                            <!-- RIGHT: Cute Resume -->
                            <g transform="translate(548, 40)">
                                <rect class="card glow" width="150" height="170" />
                                <rect x="0" y="0" width="150" height="34" rx="16" ry="16" fill="#f0fdf4" />
                                <text class="font title" x="14" y="22" style="font-size:12px;">Resume</text>
                                <text class="font label" x="14" y="34" style="transform: translateY(-6px);">Happy output
                                    ✅</text>

                                <!-- Face on resume -->
                                <circle class="face-eye" cx="118" cy="18" r="2.2" />
                                <circle class="face-eye" cx="130" cy="18" r="2.2" />
                                <path class="face-smile" d="M 120 24 Q 124 28 128 24" />
                                <circle class="blush" cx="112" cy="22" r="5" />
                                <circle class="blush" cx="136" cy="22" r="5" />

                                <!-- Lines -->
                                <line class="line out-highlight" x1="14" y1="64" x2="120" y2="64" />
                                <line class="line" x1="14" y1="80" x2="102" y2="80" />

                                <line class="line out-highlight h2" x1="14" y1="100" x2="114" y2="100" />
                                <line class="line" x1="14" y1="116" x2="98" y2="116" />

                                <line class="line out-highlight h3" x1="14" y1="136" x2="124" y2="136" />
                                <line class="line" x1="14" y1="152" x2="92" y2="152" />

                                <!-- Checks -->
                                <g transform="translate(124, 58)">
                                    <path class="check" d="M 0 7 L 5 12 L 13 0" />
                                </g>
                                <g transform="translate(124, 94)">
                                    <path class="check c2" d="M 0 7 L 5 12 L 13 0" />
                                </g>
                                <g transform="translate(124, 130)">
                                    <path class="check c3" d="M 0 7 L 5 12 L 13 0" />
                                </g>

                                <!-- Sparkles -->
                                <path class="sparkle"
                                    d="M 20 52 L 23 58 L 29 61 L 23 64 L 20 70 L 17 64 L 11 61 L 17 58 Z" />
                                <path class="sparkle s2"
                                    d="M 46 50 L 48 54 L 52 56 L 48 58 L 46 62 L 44 58 L 40 56 L 44 54 Z" />
                                <path class="sparkle s3"
                                    d="M 38 160 L 41 166 L 47 169 L 41 172 L 38 178 L 35 172 L 29 169 L 35 166 Z" />
                            </g>

                            <!-- Keyword bubbles (cutesy) -->
                            <g class="bubble-group" transform="translate(120, 110)">
                                <path class="bubble"
                                    d="M 0 12 a12 12 0 0 1 12-12 h68 a12 12 0 0 1 12 12 v1 a12 12 0 0 1-12 12 H40 l-10 8 2-8 H12 a12 12 0 0 1-12-12 z" />
                                <text class="font bubble-text" x="12" y="15">Python</text>
                            </g>

                            <g class="bubble-group b2" transform="translate(120, 140)">
                                <path class="bubble"
                                    d="M 0 12 a12 12 0 0 1 12-12 h78 a12 12 0 0 1 12 12 v1 a12 12 0 0 1-12 12 H46 l-10 8 2-8 H12 a12 12 0 0 1-12-12 z" />
                                <text class="font bubble-text" x="12" y="15">Leadership</text>
                            </g>

                            <g class="bubble-group b3" transform="translate(120, 170)">
                                <path class="bubble"
                                    d="M 0 12 a12 12 0 0 1 12-12 h62 a12 12 0 0 1 12 12 v1 a12 12 0 0 1-12 12 H36 l-10 8 2-8 H12 a12 12 0 0 1-12-12 z" />
                                <text class="font bubble-text" x="12" y="15">Metrics</text>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        {% if revisions %} <!-- Stats Section -->
        <div class="mb-6">
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-check-circle text-green-600 text-lg"></i>
                        </div>
                        <div class="text-xl font-bold text-gray-800">{{ revisions|length }}</div>
                        <div class="text-sm text-gray-600">Total Revisions</div>
                    </div>
                    <div class="text-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-clock text-blue-600 text-lg"></i>
                        </div>
                        <div class="text-xl font-bold text-gray-800">
                            {% if revisions %}
                            <span class="local-date"
                                data-utc-date="{{ revisions[0].timestamp.isoformat() if revisions[0].timestamp else '' }}">
                                {{ revisions[0].timestamp.strftime('%m/%d') if revisions[0].timestamp else 'N/A' }}
                            </span>
                            {% else %}
                            N/A
                            {% endif %}
                        </div>
                        <div class="text-sm text-gray-600">Latest Revision</div>
                    </div>
                    <div class="text-center">
                        <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-sticky-note text-amber-600 text-lg"></i>
                        </div>
                        <div class="text-xl font-bold text-gray-800">
                            {{ revisions|selectattr('has_applications')|list|length }}
                        </div>
                        <div class="text-sm text-gray-600">Applications tracked</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revisions List -->
        <div class="space-y-4">
            {% for rev in revisions %}
            <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg card-hover overflow-hidden">
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <!-- Left side - Info -->
                        <div class="flex items-start space-x-4">
                            <div
                                class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-file-alt text-white text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="text-lg font-semibold text-gray-800">Resume Revision</h3>
                                </div>
                                <div class="flex flex-col sm:flex-row sm:items-center text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <i class="fas fa-calendar-alt mr-2 text-gray-400"></i>
                                        {% if rev.timestamp %}
                                        <span class="local-datetime" data-utc-date="{{ rev.timestamp.isoformat() }}"
                                            title="Time shown in your local timezone">
                                            {{ rev.timestamp.strftime('%B %d, %Y at %I:%M %p') }}
                                        </span>
                                        {% else %}
                                        <span class="text-gray-500">Unknown date</span>
                                        {% endif %}
                                    </div>
                                </div>

                                {% if rev.job_description and rev.job_description.strip() %}
                                <div class="mt-2">
                                    <button type="button" onclick="toggleJobDesc('{{ rev.revision_id }}')"
                                        class="inline-flex items-center gap-2 text-xs font-semibold text-indigo-700 hover:text-indigo-900 hover:underline underline-offset-2">
                                        <span
                                            class="inline-flex items-center px-2 py-1 rounded-full bg-indigo-50 border border-indigo-200 text-indigo-700">
                                            <i class="fas fa-bullseye mr-1"></i> Tailored to job
                                        </span>
                                        <span>View job description</span>
                                    </button>
                                    <div id="jobdesc-{{ rev.revision_id }}" class="hidden mt-2">
                                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3">
                                            <p class="text-xs text-indigo-900 whitespace-pre-wrap">{{
                                                rev.job_description }}</p>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Right side - Actions -->
                        <div class="flex flex-col sm:flex-row gap-3">
                            <a href="/view_revision/{{ rev.revision_id }}"
                                class="inline-flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200 font-medium">
                                <i class="fas fa-eye mr-2"></i>
                                View Analysis
                            </a>
                        </div>
                    </div>

                    <!-- Tracking Section -->
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-medium text-gray-700 flex items-center">
                                <i class="fas fa-sticky-note mr-2 text-amber-500"></i>
                                Job search tracking
                            </h4>
                            <button onclick="toggleNotes('{{ rev.revision_id }}')"
                                class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                                <i class="fas fa-edit mr-1"></i>
                                {% if rev.notes %}Edit interview notes{% else %}Add interview notes{% endif %}
                            </button>
                        </div>

                        <!-- Structured applications -->
                        <div class="mb-3">
                            <div class="flex items-center justify-between mb-2">
                                <div class="text-xs font-semibold text-gray-700">Applications</div>
                                <button type="button" onclick="toggleAppForm('{{ rev.revision_id }}')"
                                    class="text-xs font-semibold text-indigo-700 hover:text-indigo-900 hover:underline underline-offset-2">
                                    <i class="fas fa-plus mr-1"></i>Add application
                                </button>
                            </div>

                            {% if rev.applications and rev.applications|length > 0 %}
                            <div class="overflow-x-auto border border-gray-200 rounded-lg bg-white">
                                <table class="min-w-full text-xs">
                                    <thead class="bg-gray-50">
                                        <tr class="text-left text-gray-600">
                                            <th class="px-3 py-2 font-semibold">Company</th>
                                            <th class="px-3 py-2 font-semibold">Role</th>
                                            <th class="px-3 py-2 font-semibold">Date</th>
                                            <th class="px-3 py-2 font-semibold">Status</th>
                                            <th class="px-3 py-2 font-semibold">Link</th>
                                            <th class="px-3 py-2 font-semibold"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        {% for a in rev.applications %}
                                        <tr class="text-gray-700">
                                            <td class="px-3 py-2 whitespace-nowrap">{{ a.company or '-' }}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">{{ a.role or '-' }}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">{{ a.date_applied or '-' }}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">{{ a.status or '-' }}</td>
                                            <td class="px-3 py-2">
                                                {% if a.link %}
                                                <a href="{{ a.link }}" target="_blank" rel="noopener"
                                                    class="text-blue-600 hover:text-blue-800 hover:underline underline-offset-2">
                                                    Open
                                                </a>
                                                {% else %}
                                                -
                                                {% endif %}
                                            </td>
                                            <td class="px-3 py-2 text-right">
                                                <form method="POST"
                                                    action="/application/delete/{{ rev.revision_id }}/{{ loop.index0 }}">
                                                    <button type="submit"
                                                        class="text-red-600 hover:text-red-800 hover:underline underline-offset-2 font-semibold">
                                                        Remove
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-xs text-gray-600 bg-gray-50 border border-gray-200 rounded-lg p-3">
                                No applications tracked yet.
                            </div>
                            {% endif %}

                            <div id="appform-{{ rev.revision_id }}" class="hidden mt-3">
                                <form method="POST" action="/application/add/{{ rev.revision_id }}"
                                    class="grid grid-cols-1 sm:grid-cols-2 gap-3 bg-indigo-50 border border-indigo-200 rounded-lg p-3">
                                    <div>
                                        <label
                                            class="block text-[11px] font-semibold text-indigo-900 mb-1">Company</label>
                                        <input name="company"
                                            class="w-full px-3 py-2 rounded-lg border border-indigo-200 text-sm"
                                            placeholder="e.g., Google" />
                                    </div>
                                    <div>
                                        <label class="block text-[11px] font-semibold text-indigo-900 mb-1">Role</label>
                                        <input name="role"
                                            class="w-full px-3 py-2 rounded-lg border border-indigo-200 text-sm"
                                            placeholder="e.g., Data Scientist" />
                                    </div>
                                    <div>
                                        <label class="block text-[11px] font-semibold text-indigo-900 mb-1">Date
                                            applied</label>
                                        <input type="date" name="date_applied"
                                            class="w-full px-3 py-2 rounded-lg border border-indigo-200 text-sm" />
                                    </div>
                                    <div>
                                        <label
                                            class="block text-[11px] font-semibold text-indigo-900 mb-1">Status</label>
                                        <select name="status"
                                            class="w-full px-3 py-2 rounded-lg border border-indigo-200 text-sm">
                                            <option value="">Select…</option>
                                            <option>Applied</option>
                                            <option>Interviewing</option>
                                            <option>Offer</option>
                                            <option>Rejected</option>
                                            <option>No response</option>
                                        </select>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label class="block text-[11px] font-semibold text-indigo-900 mb-1">Link</label>
                                        <input type="url" name="link"
                                            class="w-full px-3 py-2 rounded-lg border border-indigo-200 text-sm"
                                            placeholder="Job posting / application link (optional)" />
                                    </div>
                                    <div class="sm:col-span-2 flex items-center justify-end gap-2">
                                        <button type="button" onclick="toggleAppForm('{{ rev.revision_id }}')"
                                            class="px-3 py-2 text-sm rounded-lg bg-white border border-indigo-200 text-indigo-900 hover:bg-indigo-100">
                                            Cancel
                                        </button>
                                        <button type="submit"
                                            class="px-3 py-2 text-sm rounded-lg bg-indigo-700 text-white hover:bg-indigo-800">
                                            Save application
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Interview notes (free-text) -->
                        <div id="notes-display-{{ rev.revision_id }}" class="{% if not rev.notes %}hidden{% endif %}">
                            <div class="bg-amber-50 border border-amber-200 rounded-lg p-3">
                                <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ rev.notes or 'No notes added
                                    yet.' }}</p>
                            </div>
                        </div>

                        <!-- Edit Notes Form (initially hidden) -->
                        <div id="notes-edit-{{ rev.revision_id }}" class="{% if rev.notes %}hidden{% endif %}">
                            <form action="/update_notes/{{ rev.revision_id }}" method="POST" class="space-y-3">
                                <textarea name="notes"
                                    placeholder="Interview notes (e.g., recruiter name, screening questions, next steps, follow-up reminders, interview prep)"
                                    class="w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                    rows="3">{{ rev.notes }}</textarea>
                                <div class="flex justify-end space-x-2">
                                    <button type="button" onclick="toggleNotes('{{ rev.revision_id }}')"
                                        class="px-3 py-1.5 text-sm text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                        Cancel
                                    </button>
                                    <button type="submit"
                                        class="px-3 py-1.5 text-sm text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-save mr-1"></i>
                                        Save interview notes
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Empty state when no notes -->
                        {% if not rev.notes %}
                        <div id="notes-empty-{{ rev.revision_id }}" class="text-center py-2">
                            <p class="text-xs text-gray-500 italic">
                                <i class="fas fa-info-circle mr-1"></i>
                                Add interview notes for this version (optional)
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Call to Action -->
        <div class="mt-8 text-center">
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl p-6 text-white">
                <h3 class="text-xl font-bold mb-2">Want to improve your resume further?</h3>
                <p class="text-blue-100 mb-4">Get AI-powered suggestions and create a new revision today.</p>
                <a href="/"
                    class="inline-flex items-center px-6 py-3 bg-white text-blue-600 rounded-lg font-semibold hover:bg-blue-50 transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    Create New Revision
                </a>
            </div>
        </div>

        {% else %}
        <!-- Empty State -->
        <div class="text-center py-16">
            <div class="max-w-md mx-auto">
                <div
                    class="w-24 h-24 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-file-alt text-white text-3xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">
                    {% if user and user.name and user.name.strip() %}{{ user.name.split()[0] }}, you have{% else %}You
                    have{% endif %} no revisions yet
                </h2>
                <p class="text-gray-600 mb-8 leading-relaxed">
                    {% if user and user.name and user.name.strip() %}{{ user.name.split()[0] }}, you{% else %}You{%
                    endif %} haven't created any resume revisions yet. Start by uploading your resume and let our AI
                    help you
                    improve it!
                </p>
                <div class="space-y-4">
                    <a href="/?scroll_to_form=true#resume-form"
                        class="inline-flex items-center px-6 py-3 btn-primary text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200">
                        <i class="fas fa-upload mr-2"></i>
                        Submit resume
                    </a>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Get instant AI-powered feedback and improvements
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Review CTA -->
    <div class="max-w-6xl mx-auto p-4 mt-12 mb-10">
        <div
            class="rounded-lg shadow-lg p-8 text-center bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200">
            <div
                class="inline-flex items-center px-3 py-1 mb-3 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-700">
                <i class="fas fa-heart mr-1 text-emerald-600"></i>
                We value your feedback
            </div>
            <h2 class="text-2xl font-extrabold text-gray-800 mb-2">Enjoying ResumaticAI?</h2>
            <div class="flex justify-center mb-3" aria-hidden="true">
                <i class="fas fa-star text-amber-400 text-xl mx-0.5"></i>
                <i class="fas fa-star text-amber-400 text-xl mx-0.5"></i>
                <i class="fas fa-star text-amber-400 text-xl mx-0.5"></i>
                <i class="fas fa-star text-amber-400 text-xl mx-0.5"></i>
                <i class="fas fa-star text-amber-400 text-xl mx-0.5"></i>
            </div>
            <p class="text-gray-700 mb-5">If we helped, a quick Trustpilot review makes a big difference.</p>

            <!-- TrustBox widget - Review Collector -->
            <div class="trustpilot-widget" data-locale="en-US" data-template-id="56278e9abfbbba0bdcd568bc"
                data-businessunit-id="68c642f02962c7c6cf071fa0" data-style-height="52px" data-style-width="100%"
                data-token="53409e14-dcae-4ea5-8520-489b71c06646">
                <a href="https://www.trustpilot.com/review/resumaticai.com" target="_blank"
                    rel="noopener">Trustpilot</a>
            </div>
            <!-- End TrustBox widget -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 py-8 border-t border-gray-200 bg-white/80 backdrop-blur-sm">
        <div class="max-w-5xl mx-auto px-6 text-center">
            <p class="text-gray-600">
                <i class="fas fa-heart text-red-500 mr-1"></i>
                Powered by Resumatic AI - Your career advancement partner
            </p>
        </div>
    </footer>


    <script>
        // Feedback modal for my_revisions downloads (anchors), non-blocking
        (function () {
            var modal = document.getElementById('downloadFeedbackModal');
            var closeBtn = document.getElementById('downloadFeedbackClose');
            var submitBtn = document.getElementById('downloadFeedbackSubmit');
            var skipBtn = document.getElementById('downloadFeedbackSkip');
            var ratingInputs = document.querySelectorAll('input[name="download_rating"]');
            var commentInput = document.getElementById('downloadFeedbackComment');
            var starContainer = document.getElementById('downloadStars');
            var starLabels = starContainer ? starContainer.querySelectorAll('label[data-value]') : null;
            var comparisonInputs = document.querySelectorAll('input[name="download_comparison"]');
            var starText = document.getElementById('downloadStarText');
            var comparisonLabels = document.querySelectorAll('#downloadComparisonGroup > label');

            function openModal() {
                if (!modal) return;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
            function closeModal() {
                if (!modal) return;
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
            function updateStars(val) {
                if (!starLabels) return;
                for (var i = 0; i < starLabels.length; i++) {
                    var starVal = parseInt(starLabels[i].getAttribute('data-value'), 10);
                    if (starVal <= val) {
                        starLabels[i].classList.remove('text-gray-300');
                        starLabels[i].classList.add('text-amber-400');
                    } else {
                        starLabels[i].classList.remove('text-amber-400');
                        starLabels[i].classList.add('text-gray-300');
                    }
                }
                updateStarText(val);
            }
            function updateStarText(val) {
                if (!starText) return;
                var map = { 1: 'Very dissatisfied', 2: 'Dissatisfied', 3: 'Neutral', 4: 'Satisfied', 5: 'Very satisfied' };
                var n = parseInt(val || '0', 10);
                starText.textContent = map[n] || '';
            }
            function getSelectedRating() {
                for (var i = 0; i < ratingInputs.length; i++) {
                    if (ratingInputs[i].checked) return ratingInputs[i].value;
                }
                return '';
            }
            function getSelectedComparison() {
                for (var i = 0; i < comparisonInputs.length; i++) {
                    if (comparisonInputs[i].checked) return comparisonInputs[i].value;
                }
                return '';
            }
            function sendFeedback(rating, comment) {
                try {
                    fetch('/api/feedback/download', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            rating: rating || '',
                            comment: (comment || '').slice(0, 500),
                            comparison: getSelectedComparison() || ''
                        })
                    }).catch(function () { /* ignore errors */ });
                } catch (e) { /* ignore */ }
            }

            if (starLabels && starLabels.length) {
                for (var i = 0; i < starLabels.length; i++) {
                    starLabels[i].addEventListener('click', function () {
                        var val = parseInt(this.getAttribute('data-value'), 10);
                        var radio = document.getElementById('download_rating_' + val);
                        if (radio) radio.checked = true;
                        updateStars(val);
                    });
                    starLabels[i].addEventListener('mouseenter', function () {
                        var val = parseInt(this.getAttribute('data-value'), 10);
                        updateStars(val);
                    });
                    starLabels[i].addEventListener('mouseleave', function () {
                        var selected = parseInt(getSelectedRating() || '0', 10);
                        updateStars(selected);
                    });
                }
                updateStars(parseInt(getSelectedRating() || '0', 10));
            }
            function updateComparisonStyles() {
                if (!comparisonLabels || !comparisonLabels.length) return;
                for (var i = 0; i < comparisonLabels.length; i++) {
                    var input = comparisonLabels[i].querySelector('input[name="download_comparison"]');
                    var isActive = input && input.checked;
                    comparisonLabels[i].classList.toggle('bg-blue-50', isActive);
                    comparisonLabels[i].classList.toggle('border-blue-300', isActive);
                    comparisonLabels[i].classList.toggle('text-blue-800', isActive);
                    comparisonLabels[i].classList.toggle('border-gray-300', !isActive);
                    comparisonLabels[i].classList.toggle('text-gray-700', !isActive);
                }
            }
            if (comparisonInputs && comparisonInputs.length) {
                for (var j = 0; j < comparisonInputs.length; j++) {
                    comparisonInputs[j].addEventListener('change', updateComparisonStyles);
                }
                updateComparisonStyles();
            }
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
            if (skipBtn) skipBtn.addEventListener('click', closeModal);
            if (modal) {
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) closeModal();
                });
            }
            if (submitBtn) {
                submitBtn.addEventListener('click', function () {
                    var rating = getSelectedRating();
                    var comment = commentInput ? commentInput.value : '';
                    sendFeedback(rating, comment);
                    closeModal();
                });
            }

            // (DOCX download removed)
        })();
    </script>

</body>

</html>